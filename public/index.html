<html>
<head>
    <meta charset="utf-8">
    
    <title>Florist Project</title>

    <style>
  
      
      body {
        margin: 0;
        padding: 0;
        background-color: #2aa198;
      }
      
      canvas {
        width: 100%;
      }
      
      #hidden-canvas {
        display: none;
      }
      
      
    </style>
</head>
<body>
	
    <input type="file" accept="image/*" id="file-input">
  
    <canvas id="canvas"></canvas>
  
    <canvas id="hidden-canvas"></canvas>
  
	
    <script>
      
      const fileInput = document.getElementById('file-input');
      const canvas = document.getElementById('canvas');
      
      const hiddenCanvas = document.getElementById('hidden-canvas');
      const hiddenCtx = hiddenCanvas.getContext('2d');
      
      const ctx = canvas.getContext('2d');
      const img = new Image();
      
      const bg = new Image();
      bg.src = 'seamless.jpg';
      
      function processImage(f) {
        img.onload = function() {
          const h = img.height;
          const w = img.width;
          
          canvas.height = h;
          canvas.width = w;
          
          hiddenCanvas.height = h;
          hiddenCanvas.width = w;
          
          ctx.drawImage(img, 0, 0);
          
          const imageData = ctx.getImageData(0, 0, w, h);
          
          for(let i=0; i < imageData.data.length; i+=4) {
            const luma = Math.floor(imageData.data[i] * 0.3 + imageData.data[i+1] * 0.59 + imageData.data[i+2] * 0.11);
            
            imageData.data[i] = imageData.data[i+1] = imageData.data[i+2] = luma;
            
            if(luma < 75) 
              imageData.data[i+3] = 255;
            else if(luma < 80)
              imageData.data[i+3] = 100;
            else
              imageData.data[i+3] = 0;
          }
          
          hiddenCtx.putImageData(imageData, 0, 0);
          
          const pattern = ctx.createPattern(bg, 'repeat');
          ctx.fillStyle = pattern;
          ctx.fillRect(0, 0, w, h)
          
          ctx.drawImage(hiddenCanvas, 0, 0);
        }
        
        img.src = URL.createObjectURL(f[0]);
      }

      fileInput.addEventListener('change', (e) => processImage(e.target.files));
      
    </script>
</body>

</html>